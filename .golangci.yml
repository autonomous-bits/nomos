# yaml-language-server: $schema=https://golangci-lint.run/jsonschema/golangci.jsonschema.json
# golangci-lint configuration for Nomos monorepo
# Compatible with golangci-lint v2.9.0

version: "2"

run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly
  go: "1.26"  # Target Go version (matches go.work)

linters:
  enable:
    - errcheck       # Check for unchecked errors
    - govet          # Vet examines Go source code
    - ineffassign    # Detect ineffectual assignments
    - staticcheck    # Go static analysis (includes gosimple and stylecheck)
    - unused         # Check for unused constants, variables, functions
    - misspell       # Find commonly misspelled English words
    - revive         # Fast, configurable, extensible, flexible linter
    - gocritic       # Opinionated Go source code linter
    - unconvert      # Remove unnecessary type conversions
    - unparam        # Report unused function parameters
    - gosec          # Inspect source code for security problems
    - bodyclose      # Check for unclosed HTTP response bodies
    - noctx          # Find sending HTTP request without context.Context
    - prealloc       # Find slice declarations that could be preallocated
    - rowserrcheck   # Check for sql.Rows.Err() after sql.Rows.Close()
    - sqlclosecheck  # Check for SQL query resource leaks
    - wastedassign   # Find wasted assignment statements
    - whitespace     # Check for unnecessary whitespace

formatters:
  enable:
    - gofmt          # Check formatting
    - goimports      # Check imports formatting

linters-settings:
  revive:
    rules:
      # Disable package naming check that flags stdlib-like names
      # Our internal packages (parser, ast, scanner) don't actually conflict
      - name: var-naming
        disabled: true

issues:
  max-issues-per-linter: 0
  max-same-issues: 0
  exclude-rules:
    # Allow internal packages to use names that match stdlib packages
    # These don't actually conflict since they're in different import paths
    - linters:
        - revive
      text: "avoid package names that conflict"
